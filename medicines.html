<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine Management - POS System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @media print {
            /* Basic page setup for print */
            body { 
                background-color: white !important; 
                color: black !important; 
                height: auto !important; 
                overflow: visible !important; 
            }
            
            /* Hide unnecessary elements */
            aside, .search-container, button, .action-col { 
                display: none !important; 
            }
            
            /* Hide rows that have normal stock */
            .hide-normal-stock {
                display: none !important;
            }
            
            /* Adjust main container */
            main { 
                padding: 0 !important; 
                width: 100% !important; 
                flex: none !important;
            }
            
            /* Make text dark for readability */
            .text-white, .text-gray-300, .text-gray-400, .text-gray-500, .text-blue-100, .text-green-100, .text-orange-100, .text-purple-100, .text-blue-200, .text-green-200, .text-orange-200, .text-purple-200 {
                color: black !important;
            }

            /* Adjust cards for print */
            .grid > div {
                background-color: white !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                color: black !important;
            }
            .grid i {
                color: black !important;
            }

            /* Adjust Table for print */
            .bg-\[\#1e293b\], .bg-\[\#334155\] {
                background-color: transparent !important;
                border: none !important;
                box-shadow: none !important;
            }
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                border-bottom: 1px solid #ddd !important;
                color: black !important;
            }
            th {
                background-color: #f3f4f6 !important;
            }
            /* Hide the Actions column completely */
            th.action-col, td.action-col {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-[#0f172a] text-white font-sans flex h-screen overflow-hidden">
    
    <aside class="w-64 bg-[#1f2937] flex flex-col justify-between border-r border-gray-700 h-full flex-shrink-0">
        <div>
            <div class="p-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-center font-bold text-sm tracking-wide shadow-md flex items-center justify-center gap-2">
                <i class="fas fa-clinic-medical text-lg"></i> Point of Sale System
            </div>
           <nav class="mt-6 flex flex-col gap-2 px-4">
                <a href="index.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-home w-5"></i> Dashboard
                </a>
                <a href="pos.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-shopping-cart w-5"></i> POS
                </a>
                <a href="medicines.html" class="bg-blue-600 text-white py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-pills w-5"></i> Medicines
                </a>
                <a href="customers.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-users w-5"></i> Customers
                </a>
                <a href="sales-history.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-file-invoice-dollar w-5"></i> Sales History
                </a>
                <a href="reports.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-chart-bar w-5"></i> Reports
                </a>
                <a href="purchase-order.html" class="text-gray-300 hover:bg-gray-700 py-2.5 px-4 rounded-lg flex items-center gap-3 text-sm font-medium transition-colors">
                    <i class="fas fa-clipboard-list w-5"></i> Purchase Order
                </a>
            </nav>
        </div>
        
        <div class="p-3 bg-[#374151] m-4 rounded-xl flex items-center gap-3 shadow-lg">
            <div class="w-10 h-10 bg-gray-600 rounded-lg flex items-center justify-center font-bold text-lg">A</div>
            <div>
                <div class="text-sm font-bold text-white">Muhammad Uzair</div>
                <div class="text-xs text-gray-400">Administrator</div>
            </div>
        </div>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-white mb-1 flex items-center gap-3">
                    <i class="fas fa-boxes-stacked text-blue-500"></i> Medicine Management
                </h1>
                <p class="text-gray-400 text-sm">Manage your medicine inventory</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="window.print()" class="bg-teal-600 hover:bg-teal-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors flex items-center gap-2 shadow-lg">
                    <i class="fas fa-print"></i> Print Low Stock
                </button>
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors flex items-center gap-2 shadow-lg">
                    <i class="fas fa-plus"></i> Add Medicine
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-blue-600 p-5 rounded-xl flex items-center gap-4 shadow-lg overflow-hidden">
                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-blue-600 text-xl shadow-sm flex-shrink-0">
                    <i class="fas fa-capsules"></i>
                </div>
                <div class="overflow-hidden w-full">
                    <div class="text-xs text-blue-100 font-bold uppercase tracking-wider mb-1 truncate">Total Medicines</div>
                    <div id="total-medicines-count" class="text-xl md:text-2xl font-extrabold truncate">0</div>
                    <div class="text-xs text-blue-200 mt-1 truncate">Unique products</div>
                </div>
            </div>
            
            <div class="bg-[#16a34a] p-5 rounded-xl flex items-center gap-4 shadow-lg overflow-hidden">
                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-[#16a34a] text-xl shadow-sm flex-shrink-0">
                    <i class="fas fa-box"></i>
                </div>
                <div class="overflow-hidden w-full">
                    <div class="text-xs text-green-100 font-bold uppercase tracking-wider mb-1 truncate">Total Stock</div>
                    <div id="total-stock-count" class="text-xl md:text-2xl font-extrabold truncate">0</div>
                    <div class="text-xs text-green-200 mt-1 truncate">Units in inventory</div>
                </div>
            </div>
            
            <div class="bg-orange-600 p-5 rounded-xl flex items-center gap-4 shadow-lg overflow-hidden">
                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-orange-600 text-xl shadow-sm flex-shrink-0">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="overflow-hidden w-full">
                    <div class="text-xs text-orange-100 font-bold uppercase tracking-wider mb-1 truncate">Low Stock Alert</div>
                    <div id="low-stock-count" class="text-xl md:text-2xl font-extrabold truncate">0</div>
                    <div class="text-xs text-orange-200 mt-1 truncate">Need reorder</div>
                </div>
            </div>
            
            <div class="bg-purple-600 p-5 rounded-xl flex items-center gap-4 shadow-lg overflow-hidden">
                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-purple-600 text-xl shadow-sm flex-shrink-0">
                    <i class="fas fa-sack-dollar"></i>
                </div>
                <div class="overflow-hidden w-full">
                    <div class="text-xs text-purple-100 font-bold uppercase tracking-wider mb-1 truncate">Inventory Value</div>
                    <div id="inventory-value-count" class="text-xl md:text-2xl font-extrabold truncate" title="Total Value">PKR 0.00</div>
                    <div class="text-xs text-purple-200 mt-1 truncate">At purchase price</div>
                </div>
            </div>
        </div>

        <div class="mb-6 relative search-container">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input type="text" id="medicine-search" onkeyup="filterTable()" placeholder="Search by name, category, or scan barcode..." 
                   class="w-full max-w-md bg-[#1e293b] border border-gray-700 text-white rounded-lg py-2.5 pl-11 pr-4 focus:outline-none focus:border-blue-500">
        </div>

        <div class="bg-[#1e293b] border border-gray-700 rounded-xl overflow-hidden shadow-lg">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-[#334155] border-b border-gray-700 text-gray-400 text-xs uppercase tracking-wider">
                        <th class="p-4 font-semibold">Medicine</th>
                        <th class="p-4 font-semibold">Category</th>
                        <th class="p-4 font-semibold">Price</th>
                        <th class="p-4 font-semibold">Stock</th>
                        <th class="p-4 font-semibold">Expiry</th>
                        <th class="p-4 font-semibold">Status</th>
                        <th class="p-4 font-semibold text-center action-col">Actions</th>
                    </tr>
                </thead>
                <tbody id="medicines-table-body" class="text-sm">
                    </tbody>
            </table>
        </div>

    </main>

    <div id="medicineModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
        <div class="bg-[#1e293b] rounded-xl shadow-2xl w-full max-w-lg overflow-hidden border border-gray-700">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center bg-[#0f172a]">
                <h2 id="modalTitle" class="text-xl font-bold text-white">Add New Medicine</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="medicineForm" onsubmit="saveMedicine(event)">
                    <input type="hidden" id="medId">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Barcode / SKU (Optional)</label>
                        <div class="relative">
                            <i class="fas fa-barcode absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="medBarcode" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 pl-10 pr-3 focus:outline-none focus:border-blue-500" placeholder="Click here & scan barcode">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Medicine Name <span class="text-red-500">*</span></label>
                        <input type="text" id="medName" required class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="e.g. Panadol 500mg">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-300 mb-1">Category</label>
                        <select id="medCategory" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500 appearance-none">
                            <option value="Analgesic">Analgesic</option>
                            <option value="Dermatology">Dermatology</option>
                            <option value="Antibiotic">Antibiotic</option>
                            <option value="Syrup">Syrup</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Selling Price (PKR) <span class="text-red-500">*</span></label>
                            <input type="number" id="medPrice" step="0.01" required min="0" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Cost Price (PKR)</label>
                            <input type="number" id="medCost" step="0.01" min="0" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="0.00">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="block text-sm font-medium text-gray-300">Stock <span class="text-red-500">*</span></label>
                                <div class="flex gap-2">
                                    <label class="text-xs text-gray-400 cursor-pointer flex items-center"><input type="radio" name="stockType" value="unit" checked onchange="toggleStockType()" class="mr-1 accent-blue-500">Unit</label>
                                    <label class="text-xs text-gray-400 cursor-pointer flex items-center"><input type="radio" name="stockType" value="box" onchange="toggleStockType()" class="mr-1 accent-blue-500">Box</label>
                                </div>
                            </div>
                            
                            <div id="unitInputGroup">
                                <input type="number" id="medStock" min="0" required class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="Total Units">
                            </div>
                            
                            <div id="boxInputGroup" class="hidden gap-2">
                                <input type="number" id="medBoxes" min="0" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="Boxes" title="Number of Boxes">
                                <input type="number" id="medUnitsPerBox" min="1" class="w-full bg-[#334155] border border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500" placeholder="Units/Box" title="Units per Box">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Expiry Date <span class="text-red-500">*</span></label>
                            <input type="date" id="medExpiry" required class="w-full bg-[#334155] border border-gray-600 text-gray-300 rounded-lg py-2 px-3 focus:outline-none focus:border-blue-500">
                        </div>
                    </div>

                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-700">
                        <button type="button" onclick="closeModal()" class="px-5 py-2.5 rounded-lg font-medium text-gray-300 hover:bg-gray-700 transition-colors">Cancel</button>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-lg">Save Medicine</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Data Array 
        let medicinesData = [
            { id: 1, barcode: "123456789012", name: "CUTIS LOTION 20ML", category: "Dermatology", price: 370.00, cost: 321.90, stock: 1, expiry: "2027-06-01", status: "Active" },
            { id: 2, barcode: "", name: "TERBISIL SPRAY", category: "Dermatology", price: 520.00, cost: 452.40, stock: 1, expiry: "2027-08-01", status: "Active" },
            { id: 3, barcode: "", name: "TERBISIL LOTION 20ML", category: "Dermatology", price: 380.00, cost: 330.60, stock: 1, expiry: "2027-05-01", status: "Active" },
            { id: 4, barcode: "", name: "TERIDERM 20ML", category: "Dermatology", price: 415.00, cost: 361.05, stock: 1, expiry: "2027-10-01", status: "Active" },
            { id: 5, barcode: "890123456789", name: "PANADOL 500MG", category: "Analgesic", price: 250.00, cost: 200.00, stock: 50, expiry: "2026-12-12", status: "Active" }
        ];

        // Format Date for display
        function formatDateForDisplay(dateString) {
            const options = { year: 'numeric', month: 'short', day: '2-digit' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Render Table Function
        function renderTable(data) {
            const tbody = document.getElementById('medicines-table-body');
            tbody.innerHTML = '';

            if(data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-gray-400">No medicines found.</td></tr>';
                return;
            }

            data.forEach(med => {
                let stockHTML = '';
                let printHideClass = ''; 

                if (med.stock <= 5) {
                    stockHTML = `<span class="bg-red-900/50 text-red-400 py-1 px-3 rounded-full text-xs font-bold">${med.stock} unit</span>`;
                } else {
                    stockHTML = `<span class="text-gray-300">${med.stock} unit</span>`;
                    printHideClass = 'hide-normal-stock'; 
                }

                // Barcode HTML 
                let barcodeDisplay = med.barcode ? `<div class="text-xs text-gray-500 mt-1"><i class="fas fa-barcode"></i> ${med.barcode}</div>` : '';

                tbody.innerHTML += `
                    <tr class="border-b border-gray-700 hover:bg-[#334155] transition-colors ${printHideClass}">
                        <td class="p-4">
                            <div class="font-bold text-white">${med.name}</div>
                            ${barcodeDisplay}
                        </td>
                        <td class="p-4 text-gray-300">${med.category}</td>
                        <td class="p-4">
                            <div class="text-[#22c55e] font-bold">PKR ${med.price.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">Cost: PKR ${med.cost.toFixed(2)}</div>
                        </td>
                        <td class="p-4">${stockHTML}</td>
                        <td class="p-4 text-gray-300">${formatDateForDisplay(med.expiry)}</td>
                        <td class="p-4 text-[#22c55e] font-semibold">${med.status}</td>
                        <td class="p-4 text-center action-col">
                            <div class="flex items-center justify-center gap-3">
                                <button onclick="editMedicine(${med.id})" class="text-blue-400 hover:text-blue-300 transition-colors" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteMedicine(${med.id})" class="text-red-400 hover:text-red-300 transition-colors" title="Delete">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            updateStats();
        }

        // Update Dashboard Stats dynamically
        function updateStats() {
            document.getElementById('total-medicines-count').innerText = medicinesData.length;
            
            let totalStock = 0;
            let lowStockCount = 0;
            let inventoryValue = 0;

            medicinesData.forEach(med => {
                let stock = parseInt(med.stock) || 0;
                let cost = parseFloat(med.cost) || 0;
                
                totalStock += stock;
                
                if (stock <= 5) {
                    lowStockCount++;
                }

                inventoryValue += (cost * stock);
            });

            document.getElementById('total-stock-count').innerText = totalStock;
            document.getElementById('low-stock-count').innerText = lowStockCount;
            
            // K (compact notation) khatam kar diya, ab normal number aayega
            const formattedValue = new Intl.NumberFormat('en-PK', {
                style: 'currency',
                currency: 'PKR'
            }).format(inventoryValue);
            
            document.getElementById('inventory-value-count').innerText = formattedValue;
        }

        // Search Filter 
        function filterTable() {
            const searchTerm = document.getElementById('medicine-search').value.toLowerCase();
            const filteredData = medicinesData.filter(med => 
                med.name.toLowerCase().includes(searchTerm) || 
                med.category.toLowerCase().includes(searchTerm) ||
                (med.barcode && med.barcode.toLowerCase().includes(searchTerm))
            );
            renderTable(filteredData);
        }

        // Delete Medicine
        function deleteMedicine(id) {
            if(confirm("Are you sure you want to delete this medicine?")) {
                medicinesData = medicinesData.filter(med => med.id !== id);
                filterTable();
            }
        }

        // Modal Logic for Unit/Box Toggling 
        function toggleStockType() {
            const isBox = document.querySelector('input[name="stockType"]:checked').value === 'box';
            
            const unitGroup = document.getElementById('unitInputGroup');
            const boxGroup = document.getElementById('boxInputGroup');
            const medStock = document.getElementById('medStock');
            const medBoxes = document.getElementById('medBoxes');
            const medUnitsPerBox = document.getElementById('medUnitsPerBox');

            if (isBox) {
                unitGroup.classList.add('hidden');
                boxGroup.classList.remove('hidden');
                boxGroup.classList.add('flex');
                
                medStock.removeAttribute('required');
                medBoxes.setAttribute('required', 'true');
                medUnitsPerBox.setAttribute('required', 'true');
            } else {
                unitGroup.classList.remove('hidden');
                boxGroup.classList.add('hidden');
                boxGroup.classList.remove('flex');
                
                medStock.setAttribute('required', 'true');
                medBoxes.removeAttribute('required');
                medUnitsPerBox.removeAttribute('required');
            }
        }

        // --- Modal Logic ---
        const modal = document.getElementById('medicineModal');
        const form = document.getElementById('medicineForm');

        function openModal() {
            form.reset();
            document.getElementById('medId').value = '';
            document.getElementById('modalTitle').innerText = 'Add New Medicine';
            
            // Reset to Unit mode when adding new
            document.querySelector('input[name="stockType"][value="unit"]').checked = true;
            toggleStockType();
            
            modal.classList.remove('hidden');
            
            // Scanner ke liye barcode field pe pehle focus le ayein
            setTimeout(() => { document.getElementById('medBarcode').focus(); }, 100);
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function editMedicine(id) {
            const med = medicinesData.find(m => m.id === id);
            if(med) {
                document.getElementById('medId').value = med.id;
                document.getElementById('medBarcode').value = med.barcode || '';
                document.getElementById('medName').value = med.name;
                document.getElementById('medCategory').value = med.category;
                document.getElementById('medPrice').value = med.price;
                document.getElementById('medCost').value = med.cost;
                document.getElementById('medExpiry').value = med.expiry;
                
                // Set stock and default to Unit mode for editing
                document.querySelector('input[name="stockType"][value="unit"]').checked = true;
                toggleStockType();
                document.getElementById('medStock').value = med.stock;
                
                document.getElementById('modalTitle').innerText = 'Edit Medicine';
                modal.classList.remove('hidden');
            }
        }

        // Save (Add or Update) Medicine
        function saveMedicine(event) {
            event.preventDefault(); 

            // Final stock calculate karein Unit ya Box mode ke hisaab se
            let finalStock = 0;
            const stockType = document.querySelector('input[name="stockType"]:checked').value;
            if (stockType === 'box') {
                const boxes = parseInt(document.getElementById('medBoxes').value) || 0;
                const unitsPerBox = parseInt(document.getElementById('medUnitsPerBox').value) || 1;
                finalStock = boxes * unitsPerBox;
            } else {
                finalStock = parseInt(document.getElementById('medStock').value) || 0;
            }

            const id = document.getElementById('medId').value;
            const newMedicine = {
                id: id ? parseInt(id) : Date.now(),
                barcode: document.getElementById('medBarcode').value.trim(),
                name: document.getElementById('medName').value.toUpperCase(),
                category: document.getElementById('medCategory').value,
                price: parseFloat(document.getElementById('medPrice').value),
                cost: parseFloat(document.getElementById('medCost').value) || 0,
                stock: finalStock, 
                expiry: document.getElementById('medExpiry').value,
                status: "Active"
            };

            if (id) {
                // Update existing
                const index = medicinesData.findIndex(m => m.id === parseInt(id));
                medicinesData[index] = newMedicine;
            } else {
                // Add new
                medicinesData.push(newMedicine);
            }

            closeModal();
            filterTable(); 
        }

        // Barcode reader ko enter button dabane pe form submit karne se rokne ke liye
        document.getElementById('medBarcode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                document.getElementById('medName').focus(); 
            }
        });

        // Initial Load
        renderTable(medicinesData);
    </script>
</body>
</html>